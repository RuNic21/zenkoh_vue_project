---
description: "自動ドキュメント同期ルール（コード変更時のドキュメント/ルール自動更新マッピング・変更タイプ別更新対象・検証プロセス）"
alwaysApply: false
---

# 自動ドキュメント同期ルール

## 目的
コード変更時に関連するドキュメントやルールファイルを自動でチェック・必要に応じて更新し、プロジェクトのドキュメントが常に最新状態に保たれるようにします。

## 適用範囲
- すべてのコード変更・新規ファイル作成
- プロジェクト構造の変更
- データベーススキーマの変更
- 新機能の追加

---

## 📋 変更タイプ別ドキュメント更新マッピング

### 1. プロジェクト構造の変更
**トリガー条件:**
- 新しいディレクトリの作成
- ディレクトリ構造の変更
- ファイル/フォルダの移動または削除

**更新対象:**
- `.cursor/rules/project-structure.mdc` → ディレクトリ構造セクション
- `README.md` → プロジェクト構造セクション

**更新内容例:**
```
src/
├── [新規ディレクトリ]/
│   └── [説明追記]
```

---

### 2. 新しいページ・コンポーネントの追加
**トリガー条件:**
- `src/pages/` 配下に新しい `.vue` ファイルを作成
- `src/components/` 配下に新規コンポーネントを作成

**更新対象:**
- `.cursor/rules/project-structure.mdc` → ファイル構造および主要ファイルセクション
- `.cursor/rules/coding-style.mdc` → ファイル構造の参照セクション（必要に応じて）
- `docs/page-layout-template.md` → 新ページのレイアウトパターンが既存と異なる場合

**更新例:**
```
- [src/pages/NewPage.vue](mdc:src/pages/NewPage.vue): [ページ説明]
```

---

### 3. 新サービス/APIの追加
**トリガー条件:**
- `src/services/` 配下に新しいサービスファイルを作成
- 既存サービスに主要な関数追加

**更新対象:**
- `.cursor/rules/project-structure.mdc` → サービス層セクション
- `.cursor/rules/database-integration.mdc` → サービス関連セクション
- `docs/database-integration-guide.md` → API使用例

**更新例:**
```
- [src/services/newService.ts](mdc:src/services/newService.ts): [サービスの説明]
```

---

### 4. データベーススキーマの変更
**トリガー条件:**
- `src/types/db/` 配下の型ファイル変更（自動生成後）
- Supabaseテーブルの追加・修正
- 新しいリレーションの作成

**更新対象:**
- `docs/database-schema.md` → テーブル定義およびリレーション図
- `.cursor/rules/database-integration.mdc` → スキーマ構造セクション
- `.cursor/rules/project-structure.mdc` → 型定義セクション

**更新内容:**
- テーブルスキマ図
- フィールド一覧・制約事項
- 外部キーリレーション
- RLSポリシー（該当する場合）

---

### 5. 新しい型定義の追加
**トリガー条件:**
- `src/types/` 配下に新しい型ファイルを作成（dbフォルダ除く）
- 既存型に主要なインターフェイスを追加

**更新対象:**
- `.cursor/rules/project-structure.mdc` → 型定義セクション
- `.cursor/rules/coding-style.mdc` → 型定義例（必要に応じて）

---

### 6. 新しいユーティリティ・ヘルパー関数の追加
**トリガー条件:**
- `src/utils/` 配下に新しいファイル作成
- 既存ユーティリティに主要関数追加

**更新対象:**
- `.cursor/rules/project-structure.mdc` → ユーティリティセクション
- `.cursor/rules/coding-style.mdc` → ユーティリティ関数例

---

### 7. ストア(State 管理)の変更
**トリガー条件:**
- `src/store/` 配下に新しいストアファイル作成
- 既存ストアに主要なstate追加

**更新対象:**
- `.cursor/rules/project-structure.mdc` → ストア（状態管理）セクション
- `.cursor/rules/vue-patterns.mdc` → Store利用パターン

---

### 8. ルーターの変更
**トリガー条件:**
- `src/router/index.ts` を修正
- 新しいルートの追加または既存の変更

**更新対象:**
- `docs/vue-router-integration.md` → ルート構成セクション
- `.cursor/rules/project-structure.mdc` → ページセクション（新規ページ追加時）

---

### 9. UIコンポーネントのスタイル変更
**トリガー条件:**
- Material Dashboard スタイルカスタマイズ
- 新しいデザインパターン導入

**更新対象:**
- `.cursor/rules/material-dashboard-ui-styles.mdc` → 対象コンポーネントセクション
- `docs/ui-ux-style-guide.md` → デザインガイドライン

---

### 10. 認証システムの変更
**トリガー条件:**
- `src/services/authService.ts` の修正
- 認証関連composableの変更
- 新しい認証方式追加

**更新対象:**
- `docs/auth-system-integration.md` → 認証フローと実装
- `.cursor/rules/project-structure.mdc` → 認証関連セクション

---

### 11. 定数定義の変更
**トリガー条件:**
- `src/constants/` 配下ファイルの修正
- 新しい定数ファイルの追加

**更新対象:**
- `docs/constants-refactoring.md` → 定数構造・利用方法
- `.cursor/rules/project-structure.mdc` → 定数定義セクション

---

### 12. 新しい依存関係の追加
**トリガー条件:**
- `package.json` へ新しいライブラリ追加
- 主要ライブラリのバージョンアップ

**更新対象:**
- `.cursor/rules/project-structure.mdc` → 依存関係セクション
- `README.md` → 技術スタックセクション

---

## 🔄 自動アップデートプロセス

### Step 1: 変更の検知
コード変更完了後、次を確認:
```
1. どのファイル/ディレクトリが追加・修正・削除されたか
2. 変更の性質（構造/機能/スタイル）
3. 影響範囲（特定モジュール/全体）
```

### Step 2: 影響ドキュメントの特定
上記マッピングテーブルに基づき
```
- 更新が必要な .mdc ファイル一覧
- 更新が必要な .md ファイル一覧
- 各ファイルの更新セクション
```

### Step 3: ドキュメント更新実行
各ドキュメントごとに
```
1. ファイルを読み込み
2. 関連セクションを探す
3. 内容を更新
4. ファイルを保存
```

### Step 4: 更新内容の確認
```
- 更新されたファイル一覧を出力
- 主な変更点の要約
- 追加レビューが必要な箇所を示す
```

---

## 📝 アップデート時の注意点

### 1. 一貫性の維持
- 既存ドキュメントのトーン・スタイルを維持
- フォーマット規則準拠（Markdown体裁、インデント等）
- リンク形式維持（`[テキスト](mdc:パス)` または通常リンク）

### 2. 内容の品質
- 明確かつ簡潔な説明
- 実際のコードと一致する例示
- コード例内の日本語コメントは維持
- ドキュメント本文の日本語説明

### 3. 重複防止
- 同一情報が複数ファイルにある場合、すべて更新
- リンクによる参照を積極活用

### 4. 検証
- ファイルパスが実在するか確認
- コード例が文法的に正しいか確認
- テーブル構造が崩れていないか確認

---

## 🎯 実行タイミング

### 自動トリガー
次操作後に自動でドキュメント同期を確認:
- 新規ファイル作成
- ディレクトリ構造変更
- 主要な関数・クラス追加
- DB型再生成
- ルーター修正
- サービス層の変更

### 手動確認
次のケースではユーザーにドキュメント更新要否を確認:
- 既存関数シグネチャの変更
- 内部ロジックの変更（動作変更時）
- 軽微なバグ修正

---

## 💡 利用例

### 例1: 新ページの追加
```
ユーザー: "src/pages/に SettingsPage.vue を作成して"

AI応答:
1. SettingsPage.vue を新規作成
2. ルーターに登録
3. ドキュメント更新:
   - .cursor/rules/project-structure.mdc 更新
     → pages一覧に SettingsPage.vue を追加
   - docs/vue-router-integration.md 更新
     → 新ルート情報追加
```

### 例2: 新サービスの追加
```
ユーザー: "ユーザー設定管理の settingsService.ts を作って"

AI応答:
1. src/services/settingsService.ts 新規作成
2. 必要な型定義追加
3. ドキュメント更新:
   - .cursor/rules/project-structure.mdc 更新
     → サービス層一覧に settingsService 追加
   - .cursor/rules/database-integration.mdc 更新
     → 新サービス使用パターンを追加（必要な場合）
```

### 例3: データベーステーブルの追加
```
ユーザー: "settings テーブルを追加して型作った"

AI応答:
1. 型生成を確認
2. ドキュメント更新:
   - docs/database-schema.md 更新
     → settingsテーブルスキーマ追加
   - .cursor/rules/database-integration.mdc 更新
     → 新しいテーブル情報追加
   - .cursor/rules/project-structure.mdc 更新
     → 型一覧に settings.ts 追加
```

---

## ⚙️ 設定・カスタマイズ

### アップデートレベルの設定
```typescript
// 自動アップデートレベル
enum UpdateLevel {
  MINIMAL,        // 必須のアップデートのみ
  STANDARD,       // 推奨アップデート（デフォルト）
  COMPREHENSIVE   // 関連全ドキュメントを更新
}
```

### 除外パターン
次のような変更はドキュメント更新トリガーとしない:
- 一時ファイルの作成/削除
- テストファイルの修正（scripts/配下）
- ビルド生成物（dist/, node_modules/）
- 設定ファイルの軽微な調整

---

## 📊 アップデートチェックリスト

変更作業完了後:
- [ ] 影響ドキュメント一覧の特定
- [ ] 各ドキュメントの関連セクション更新
- [ ] ファイルパス・リンクの検証
- [ ] コード例検証
- [ ] フォーマット一貫性の確認
- [ ] ユーザーへアップデート完了通知

---

## 🔍 検証方法

### 自動検証
- ファイルパス実在確認
- Markdown文法エラー
- リンクの有効性

### 手動レビュー推奨
- 説明の正確性
- コード例の妥当性
- ドキュメント全体の流れ

---

このルールは、プロジェクトのドキュメントが常にコードベースと同期されて維持されることを保証し、開発体験の向上・保守性向上を実現します。
