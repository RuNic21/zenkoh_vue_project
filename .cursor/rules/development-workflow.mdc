---
description: 開発ワークフローとデバッグガイド（選択的参照）
---

# 開発ワークフローガイド

## 🚀 開発開始手順

> **注意**: 詳細な環境セットアップは `project-structure.mdc` を参照してください。

### 1. 環境セットアップ
```bash
# 依存関係インストール
npm install

# 環境変数設定
# .env.local に以下を設定:
# VITE_SUPABASE_URL=your_supabase_url
# VITE_SUPABASE_ANON_KEY=your_supabase_anon_key

# 接続テスト
npm run test:env
```

### 2. データベース初期化
```bash
# シードデータ生成
npm run seed:all

# データ確認
npm run debug:count
```

### 3. 開発サーバー起動
```bash
npm run dev
```

## 🔧 開発サイクル

### 1. 新機能開発
```bash
# 1. 型生成（スキーマ変更時）
npm run types:gen

# 2. サービス関数作成
# src/services/ に新しいサービス関数を追加

# 3. アダプター関数追加
# src/utils/taskAdapter.ts に変換関数を追加

# 4. Store関数実装
# src/store/schedule.ts に新しい操作を追加

# 5. コンポーネント実装
# src/pages/ または src/components/ に新しいコンポーネントを作成

# 6. テスト実行
npm run test:crud:all
```

### 2. データベース変更時
```bash
# 1. Supabaseでスキーマ修正
# 2. 型再生成
npm run types:gen

# 3. アダプター関数更新
# src/utils/taskAdapter.ts を修正

# 4. テスト実行
npm run test:crud:all

# 5. シードデータ再生成（必要に応じて）
npm run seed:all
```

## 🐛 デバッグ手順

### 1. 接続エラー
```bash
# 環境変数確認
npm run test:env

# 出力例:
# 環境変数の読み込みに成功しました
# VITE_SUPABASE_URL: https://xxx.supabase.co
# VITE_SUPABASE_ANON_KEY: eyJ...xxx
# 接続に成功しました
```

### 2. データエラー
```bash
# レコード数確認
npm run debug:count

# 出力例:
# projects: 3 件
# tasks: 30 件
# users: 5 件
```

### 3. CRUD操作エラー
```bash
# 全体CRUDテスト
npm run test:crud:all

# 特定テーブルテスト
npm run test:projects
npm run test:tasks
```

### 4. ブラウザ開発者ツール
```javascript
// Store状態確認
console.log(store.schedules.value);
console.log(store.selectedSchedule.value);

// 選択されたスケジュールID確認
console.log(store.selectedScheduleId.value);

// エラー確認
console.error("エラーメッセージ");
```

## 📊 データ管理

### 1. シードデータ生成
```bash
# 全体シードデータ
npm run seed:all

# 特定テーブルシード
npm run seed:projects
npm run seed:tasks
```

### 2. データエクスポート
```bash
# CSVエクスポート
npm run export:csv

# 出力先: exports/ ディレクトリ
```

### 3. データ検証
```bash
# レコード数確認
npm run debug:count

# 特定データ確認
npm run probe:alert
npm run probe:task:priority
```

## 🔍 トラブルシューティング

### 1. よくあるエラー

#### 環境変数エラー
```
環境変数が見つかりません: VITE_SUPABASE_URL / VITE_SUPABASE_ANON_KEY
```
**解決方法**: `.env.local` ファイルに環境変数を設定

#### 型エラー
```
Property 'someField' does not exist on type 'Task'
```
**解決方法**: `npm run types:gen` で型を再生成

#### データなしエラー
```
スケジュールデータをDBから読み込みました: 0 件
```
**解決方法**: `npm run seed:all` でシードデータを生成

#### サービス層エラー
```
Cannot find module './scheduleService'
```
**解決方法**: `src/store/schedule.ts` の `useScheduleStore()` を使用

### 2. パフォーマンス問題

#### 遅い読み込み
- ネットワークタブでAPI呼び出しを確認
- 不要なデータ取得を避ける
- ページネーションを実装

#### メモリリーク
- コンポーネントの `onUnmounted` でクリーンアップ
- イベントリスナーの削除
- タイマーのクリア

### 3. UI問題

#### スタイルが適用されない
- Material Dashboard CSS の読み込み確認
- `scoped` スタイルの確認
- クラス名の確認

#### レスポンシブ問題
- Bootstrap グリッドクラスの確認
- メディアクエリの確認
- デバイスサイズでのテスト

## 📝 コードレビューチェックリスト

### 1. コード品質
- [ ] 日本語コメントが適切に記述されている
- [ ] エラーハンドリングが実装されている
- [ ] 型定義が適切に使用されている
- [ ] 不要なコードが削除されている

### 2. パフォーマンス
- [ ] 不要な再レンダリングを避けている
- [ ] 適切な `key` 属性が設定されている
- [ ] メモリリークの可能性がない

### 3. アクセシビリティ
- [ ] セマンティックなHTML要素を使用している
- [ ] 適切な `aria-label` が設定されている
- [ ] キーボードナビゲーションが可能

### 4. セキュリティ
- [ ] ユーザー入力の検証が実装されている
- [ ] XSS対策が実装されている
- [ ] 機密情報が露出していない

## 🚀 デプロイ準備

### 1. ビルドテスト
```bash
# プロダクションビルド
npm run build

# ビルド結果プレビュー
npm run preview
```

### 2. 最終確認
- [ ] 環境変数が本番環境で設定されている
- [ ] データベース接続が正常
- [ ] 全機能が動作する
- [ ] パフォーマンスが許容範囲内

### 3. ドキュメント更新
- [ ] README.md の更新
- [ ] 変更履歴の記録
- [ ] 新しい機能の説明追加